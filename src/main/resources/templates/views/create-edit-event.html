<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:if="*{id == null}"> Create Event </title>
    <title th:if="*{id != null}"> Edit Event </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/popover.css}">
</head>
<body>

    <!--Nav Bar-->
    <nav th:replace="partials/partials.html :: navbar"></nav>

    <!--Header-->
    <div th:replace="partials/partials.html :: header"></div>


            <!--Create Event Form-->

            <form th:object="${event}" th:if="*{id == null}" id="create-event" th:action="@{/event/create}" method="POST" class ="needs-validation" novalidate>

                <h1 class="text-center"> Create Event </h1>

                <h4 class="text-center"> Event Info:</h4>

                <!--Flexbox container w/ two columns: Image on the left, Event info on right-->
                <div class="d-flex justify-content-between">


                    <!--Images Column (create)-->
                    <div class="w-100 px-5 py-3 bg-light bg-gradient">

                        <!--Image input (create)-->
                        <div class="form-outline mt-3">
                            <button type="button" class="form-control form-control-lg picker">
                                (+) Add images
                            </button>
                            <div id="image-url"></div>
                        </div>

                    </div>

                    <!--Event Main Info Column (create)-->
                    <div class="w-100 d-flex flex-column text-center">

                        <!--Event name (create)-->
                        <div class="p-3">
                            <label for="title">Event Name</label>
                            <input type="text" class="form-control" id="title" placeholder='"DnD marathon," "Workout buddies," "Casual soccer at the park," etc...' th:field="*{eventName}" required>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Please add a name for your event.
                            </div>
                        </div>

                        <!--Description (create)-->
                        <div class="p-3">
                            <label for="Description">Description</label>
                            <textarea class="form-control" id="Description" rows="3" placeholder="The more descriptive the better! You may include details such as equipment necessary, weather considerations, and any other relevant information for your event." th:field="*{eventDescription}" required></textarea>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Please add a description for your event.
                            </div>
                        </div>



                        <!--Start date and time (create)-->
                        <label for="start-date-time"> Start Date & Time </label>
                        <div id="start-date-time" class="d-flex justify-content-center">
                            <div class="px-1">
                                <input type="date" id="date" name="date" class="form-control form-control-lg" placeholder="" th:field="*{startDate}" required/>
                                <div class="valid-feedback">
                                    Looks good!
                                </div>
                                <div class="invalid-feedback">
                                    Please select a start date for your event
                                </div>
                            </div>
                            <div>
                                <input type="time" id="start-time" name="date" class="form-control form-control-lg" placeholder="" th:field="*{startTime}" required/>
                                <div class="valid-feedback">
                                    Looks good!
                                </div>
                                <div class="invalid-feedback">
                                    Please add a start time for your event.
                                </div>
                            </div>
                        </div>

                        <!--End date and time (create)-->
                        <label for="end-date-time"> End Date & Time (optional) </label>
                        <div id="end-date-time" class="d-flex justify-content-center mb-3">
                            <div class="px-1">
                                <input type="date" id="end-date" name="end-time" class="form-control form-control-lg" placeholder="" th:field="*{endDate}">
                            </div>
                            <div>
                                <input type="time" id="end-time" name="date" class="form-control form-control-lg" placeholder="" th:field="*{endTime}"  />
                            </div>
                        </div>

                        <!--Address (create)-->
                        <label for="address-div"> Event Address </label>
                        <div id="address-div" class="px-3">
                            <input class="w-100" type="text" name="address" id="address" th:field="*{address}" placeholder="123 street name st" required>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Please add an address for your event.
                            </div>
                        </div>

                    </div>

                </div>

                <!--Event details [category, hobbies, public, etc] (create)-->

                <h4 class="text-center mb-3 mt-5"> Event Details: </h4>

                <div class="d-flex">

                    <!--Event details, Column 1: category, hobbies, and expertise-->
                    <div class="w-100 px-3 text-center">

                        <!--Hobbies (create)-->
                        <label for="hobbies" class="form-label">
                            Hobby or hobbies for this event:
                        </label>
                        <div id="hobbies" class="mb-3">
                            <select class="form-select" multiple size="3" required>
                                <option th:each="hobby : ${userHobbies}" th:text="${hobby.hobbyName}" th:value="${hobby.id}" name="hobbies"></option>
                            </select>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Please select at least one hobby for your event.
                            </div>
                        </div>

                        <!--Category (create)-->
                        <div class="mb-3">
                            <label for="categories" class="form-label">Category</label>
                            <select id="categories" class="form-select" th:field="*{categoryId}" required>
                                <option disabled value="0" name="category">Select a category...</option>
                                <option name="category" value="1">Indoor</option>
                                <option name="category" value="2">Outdoor</option>
                            </select>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Please select a category for your event.
                            </div>
                        </div>

                        <!--Expertise level (create)-->
                        <div>
                            <label for="expertise" class="form-label">Expertise</label>
                            <select id="expertise" name="expertise" class="form-select" required>
                                <option selected disabled value="0" name="expertise">Select your level of expertise...</option>
                                <option name="expertise" value="1">Beginner</option>
                                <option name="expertise" value="2">Intermediate</option>
                                <option name="expertise" value="3">Advanced</option>
                            </select>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Please select your expertise for your event.
                            </div>
                        </div>



                    <!--*** end of column 1 *** (create)-->
                    </div>


                    <!--Event details, Column 2: public, age, RSVPable-->
                    <div class="d-flex flex-column w-100 px-3 mt-3 justify-space-between">

                        <!--RSVPable (create)-->
                        <div class="mb-3 form-check form-switch form-check-reverse">
                            <label class="form-check-label" for="rsvp">
                                Would you like users to RSVP?
                            </label>
                            <input class="form-check-input" type="checkbox" role="switch" id="rsvp" name="rsvp" th:field="*{rsvpAble}" th:checked="flag">
                        </div>

                        <!--Is it public? (create)-->
                        <div class="mb-3 form-check form-switch form-check-reverse">
                            <label class="form-check-label" for="public">
                                Would you like your event to be visible to non-registered users?
                            </label>
                            <input class="form-check-input" type="checkbox" role="switch" id="public" name="public" th:field="*{public}">
                        </div>


                        <!--Age Restriction (create)-->
                        <div class="mb-3 form-check form-switch form-check-reverse">
                            <label class="form-check-label" for="age">
                                Would you like your event to be visible only to registered users that are older than 18?
                            </label>
                            <input class="form-check-input" type="checkbox" role="switch" id="age" name="age-restriction" th:field="*{ageRestricted}">
                        </div>

                        <!--Reference URL (create)-->
                        <label class="text-center" for="ref-url">Reference URL</label>
                        <div>
                            <input class="w-100 mb-3" type="url" name="ref-url" id="ref-url" th:field="*{referenceUrl}">
                        </div>

                    </div>
                    <!--*** end of column 2 *** (create)-->


                </div>
                <!--*** end of event details *** (create)-->

                <!--Creation date (hidden input)-->
                <input hidden id="current-date-create" name="current-date" th:field="*{createdEvent}">
                <!--script below gets the current date and assigns the value to the element above-->
                <script>
                    var today = new Date();
                    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
                    let currentDateElementForCreateEvent = document.getElementById("current-date-create");
                    currentDateElementForCreateEvent.setAttribute("value", date);
                </script>

                <div class="d-flex justify-content-center mb-3 mt-5">
                    <button type="submit" class="btn btn-success">
                        Create Event
                    </button>
                </div>
                <!--script below stops form from submitting if required fields are empty-->
                <script>
                    (() => {
                        'use strict'

                        // Fetch all the forms we want to apply custom Bootstrap validation styles to
                        const forms = document.querySelectorAll('.needs-validation')

                        // Loop over them and prevent submission
                        Array.from(forms).forEach(form => {
                            form.addEventListener('submit', event => {
                                if (!form.checkValidity()) {
                                    event.preventDefault()
                                    event.stopPropagation()
                                }

                                form.classList.add('was-validated')
                            }, false)
                        })
                    })()
                </script>

            </form>
            <!--End of the Create Form-->



    <!--Edit Form-->
    <div class="card-body" th:object="${event}" th:if="*{id != null}">

        <h1> Edit Event </h1>

        <div class="card mx-auto text-center" style="width: 80rem;">

            <div th:if="${images.size() > 0}" id="carouselExampleIndicators" class="carousel slide w-50 mx-auto" data-bs-ride="true">

                <div th:if="${event.eventImages.size() > 1}" class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>

                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>

                    <button th:if="${event.eventImages.size() > 2}" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>

                    <button th:if="${event.eventImages.size() > 3}" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4"></button>

                    <button th:if="${event.eventImages.size() > 4}" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4" aria-label="Slide 5"></button>
                </div>


                <!--Images from the database-->
                <div class="carousel-item active ratio ratio-16x9">
                    <img th:src="${event.eventImages.get(0).url}" class="d-block w-100" th:alt="${event.eventImages.get(0).imageDescription}">
                    <div class="carousel-caption d-none d-md-block">
                        <form th:action="@{/event/delete-image}" method="post">
                            <input type="hidden" th:value="${event.eventImages.get(0).id}" name="id">
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>

                <div th:if="${event.eventImages.size() > 1}" class="carousel-item ratio ratio-16x9">
                    <img th:src="${event.eventImages.get(1).url}" class="d-block w-100" th:alt="${event.eventImages.get(1).imageDescription}">
                    <div class="carousel-caption d-none d-md-block">
                        <form th:action="@{/event/delete-image}" method="post">
                            <input type="hidden" th:value="${event.eventImages.get(1).id}" name="id">
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>

                <div th:if="${event.eventImages.size() > 2}" class="carousel-item ratio ratio-16x9">
                    <img th:src="${event.eventImages.get(2).url}" class="d-block w-100" th:alt="${event.eventImages.get(2).imageDescription}">
                    <div class="carousel-caption d-none d-md-block">
                        <form th:action="@{/event/delete-image}" method="post">
                            <input type="hidden" th:value="${event.eventImages.get(2).id}" name="id">
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>

                <div th:if="${event.eventImages.size() > 3}" class="carousel-item ratio ratio-16x9">
                    <img th:src="${event.eventImages.get(3).url}" class="d-block w-100" th:alt="${event.eventImages.get(3).imageDescription}">
                    <div class="carousel-caption d-none d-md-block">
                        <form th:action="@{/event/delete-image}" method="post">
                            <input type="hidden" th:value="${event.eventImages.get(3).id}" name="id">
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>

                <div th:if="${event.eventImages.size() > 4}" class="carousel-item ratio ratio-16x9">
                    <img th:src="${event.eventImages.get(4).url}" class="d-block w-100" th:alt="${event.eventImages.get(4).imageDescription}">
                    <div class="carousel-caption d-none d-md-block">
                        <form th:action="@{/event/delete-image}" method="post">
                            <input type="hidden" th:value="${event.eventImages.get(4).id}" name="id">
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>

                <!--Carousel navigation buttons-->
                <div th:if="${event.eventImages.size() > 1}">
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>

                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

            </div>

            <form id="edit-event" th:action="@{/event/edit/{id}(id=${event.getId()})}" method="POST">



                    <!--Event name (edit)-->
                    <div class="mb-3">
                        <label for="edit-title">Event Title</label>
                        <input type="text" class="form-control" id="edit-title" placeholder="Event Title" th:field="*{eventName}">
                    </div>

                    <!--Description (edit)-->
                    <div class="mb-3">
                        <label for="Description">Description</label><textarea class="form-control" id="edit-description" rows="3" placeholder="Event description. You may include details such as equipment necessary, weather considerations, and any other relevant information to the event." th:field="*{eventDescription}"></textarea>
                    </div>


                <ul class="list-group list-group-flush">

                    <!--Start date and time (edit)-->
                    <li class="list-group-item">
                        <label for="edit-date"> Start Date  of Event </label>

                        <input type="date" id="edit-date" name="date" class="form-control form-control-lg" placeholder="" th:field="*{startDate}"  />
                    </li>
                    <li class="list-group-item">
                        <label for="edit-start-time"> Start Time of Event </label>

                        <input type="time" id="edit-start-time" name="date" class="form-control form-control-lg" placeholder="" th:field="*{startTime}"  />
                    </li>

                    <!--End date and time (edit)-->
                    <li class="list-group-item">
                        <label for="edit-end-date"> End Date </label>
                        <input type="date" id="edit-end-date" name="end-time" class="form-control form-control-lg" placeholder="" th:field="*{endDate}">
                    </li>
                    <li class="list-group-item">
                        <label for="edit-end-time"> End Time </label>
                        <input type="time" id="edit-end-time" name="date" class="form-control form-control-lg" placeholder="" th:field="*{endTime}"  />
                    </li>

                    <!--Address (edit)-->
                    <li class="list-group-item">
                        <label for="edit-address"> Event Address </label>
                        <input type="text" name="address" id="edit-address" th:field="*{address}">
                    </li>

                    <!--Category (edit)-->
                    <li>
                        <label for="edit-categories">Category</label>
                        <select id="edit-categories" class="form-select" aria-label="Default select example" th:field="*{categoryId}">
                            <option name="category" value="1">Indoor</option>
                            <option name="category" value="2">Outdoor</option>
                        </select>
                    </li>

                    <!--Reference URL (edit)-->
                    <div>
                        <label for="edit-ref-url">Reference URL</label>
                        <input type="url" name="ref-url" id="edit-ref-url" th:field="*{referenceUrl}">
                        <span class="tooltip">Is it working?</span>
                    </div>

                    <!--Is it public? (edit)-->
                    <li class="list-group-item">
                        <label for="edit-public"> Public Event? </label>
                        <input type="checkbox" id="edit-public" name="public" th:field="*{public}">
                    </li>

                    <!--RSVPable (edit)-->
                    <li class="list-group-item">
                        <label for="edit-rsvp"> Would you like users to RSVP? </label>
                        <input type="checkbox" id="edit-rsvp" name="rsvp" th:field="*{rsvpAble}">
                    </li>

                    <!--Age Restriction (edit)-->
                    <li class="list-group-item">
                        <label for="edit-age">Age Restriction</label>
                        <input type="checkbox" id="edit-age" name="age-restriction" th:field="*{ageRestricted}">
                    </li>
                </ul>

                <div class="form-outline mt-3">
                    <button type="button" class="form-control form-control-lg picker">Upload image</button>
                    <div id="image-url"></div>
                </div>


                <div class="d-flex justify-content-between align-items-center">
                </div>

                <!--Creation date (hidden input)-->
                <input hidden id="current-date-edit" name="current-date" th:field="*{updatedEvent}">
                <!--script below gets the current date and assigns the value to the element above-->
                <script>
					let today = new Date();
					let date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
					let currentDateElementForEditEvent = document.getElementById("current-date-edit");
					currentDateElementForEditEvent.setAttribute("value", date);
                </script>


                <button type="submit" class="btn btn-primary"> Submit Changes </button>

            </form>
            <!--End of the Edit Form-->

        </div>
    </div>



    <!--Footer-->
    <div th:replace="partials/partials.html :: footer"></div>

    <!--Bootstrap JS Script Tag-->
    <script th:replace="partials/partials.html :: bootstrap-js"></script>

    <!--External Script Tags-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <script th:src="@{/js/mapbox-geocoder-utils.js}"></script>
    <script th:replace="partials/partials.html :: bootstrap-js" ></script>
    <script th:replace="partials/partials.html :: file-stack" ></script>
    <script th:replace="partials/partials.html :: file-js" ></script>
    <script th:replace="partials/partials.html :: map-js" ></script>
    <script th:replace="partials/partials.html :: keys-js" ></script>
    <script th:replace="partials/partials.html :: environment-keys" ></script>



</body>
</html>